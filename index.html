<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management System - Genetic Invent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeInDown 1s ease-out;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-card, .users-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInUp 0.8s ease-out;
            position: relative;
        }

        .form-card h2, .users-card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 20px rgba(229, 62, 62, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .users-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #4a5568;
        }

        .users-table tr:hover {
            background: #f1f5f9;
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-size: 18px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideInDown 0.5s ease;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .tooltip {
            position: absolute;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 15px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            z-index: 1000;
            opacity: 0;
            pointer-events: auto;
            transition: all 0.3s ease;
            max-width: 600px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            line-height: 1.4;
            cursor: text;
            user-select: text;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tooltip.show {
            opacity: 1;
            animation: tooltipSlideIn 0.3s ease;
        }

        .tooltip:hover {
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5), 0 0 20px rgba(102, 126, 234, 0.3);
        }

        @keyframes tooltipSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .tooltip-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 18px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tooltip-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: #667eea transparent transparent transparent;
        }

        .info-panel {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .info-panel-button {
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .info-panel-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(72, 187, 120, 0.4);
            background: linear-gradient(135deg, #4fd982 0%, #3dd974 100%);
        }

        .info-panel-button:active {
            transform: translateY(-2px);
        }

        .click-hint {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .project-details-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .project-details-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            animation: slideInUp 0.5s ease;
        }

        .project-details-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 20px;
        }

        .project-details-header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #fff, #f0f8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .detail-section {
            margin: 30px 0;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border-left: 5px solid #48bb78;
            backdrop-filter: blur(10px);
        }

        .detail-section h3 {
            color: #48bb78;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tech-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .tech-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }

        .tech-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }

        .benefits-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .benefit-item {
            background: rgba(72, 187, 120, 0.2);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #48bb78;
        }

        .close-details {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-details:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translate(-50%, -30%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .demo-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .flow-step {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            position: relative;
        }

        .flow-step::after {
            content: '→';
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #48bb78;
        }

        .flow-step:last-child::after {
            display: none;
        }

        @media (max-width: 768px) {
            .project-details-content {
                width: 95%;
                padding: 20px;
            }
            
            .project-details-header h1 {
                font-size: 2em;
            }
            
            .tech-grid {
                grid-template-columns: 1fr;
            }
            
            .demo-flow {
                flex-direction: column;
            }
            
            .flow-step::after {
                display: none;
            }
        }

        .api-source-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(237, 137, 54, 0.4);
            transition: all 0.3s ease;
        }

        .api-source-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.6);
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .form-card, .users-card {
                padding: 20px;
            }
        }

        .status-message {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
            display: none;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🧬 User Management System</h1>
            <p class="subtitle">Demo project connecting GitHub Pages with PHP Backend on Hostinger</p>
        </header>

        <button class="info-panel info-panel-button" onclick="showProjectDetails()" 
                data-tooltip="Click to open detailed project explanation">
            <h3>🎯 Project Goal</h3>
            <p>This project demonstrates how to connect a frontend hosted on GitHub Pages with a PHP backend hosted on Hostinger</p>
            <p>Employees can learn CRUD operations and API communication methods</p>
            <div class="click-hint">✨ Click for detailed explanation ✨</div>
        </button>

        <div class="main-content">
            <div class="form-card">
                <h2 data-tooltip="Data input form - uses JavaScript for data validation before submission">📝 Add/Edit User</h2>
                
                <div class="status-message" id="statusMessage"></div>
                
                <form id="userForm" data-tooltip="HTML form that uses fetch() API to send data to backend">
                    <input type="hidden" id="userId" data-tooltip="Hidden field to store user ID during editing">
                    
                    <div class="form-group">
                        <label for="userName" data-tooltip="Field label - linked to field via for attribute">Name:</label>
                        <input type="text" id="userName" required 
                               data-tooltip="Text input field with required validation - sends value via POST to api.php">
                    </div>
                    
                    <div class="form-group">
                        <label for="userEmail" data-tooltip="Email field label">Email:</label>
                        <input type="email" id="userEmail" required 
                               data-tooltip="Email field with automatic validation - uses HTML5 validation">
                    </div>
                    
                    <div class="form-group">
                        <label for="userPhone" data-tooltip="Phone number field label">Phone:</label>
                        <input type="tel" id="userPhone" required 
                               data-tooltip="Phone field - can add validation pattern using pattern attribute">
                    </div>
                    
                    <button type="submit" class="btn" id="submitBtn" 
                            data-tooltip="Submit button executes form submit event:

userForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData();
    const id = document.getElementById('userId').value;
    
    if (id) {
        formData.append('action', 'update');
        formData.append('id', id);
    } else {
        formData.append('action', 'create');
    }
    
    formData.append('name', document.getElementById('userName').value);
    formData.append('email', document.getElementById('userEmail').value);
    formData.append('phone', document.getElementById('userPhone').value);

    try {
        showLoading(true);
        const response = await fetch(API_URL, {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        if (result.success) {
            showMessage(result.message, 'success');
            userForm.reset();
            loadUsers();
        } else {
            showMessage(result.message, 'error');
        }
    } catch (error) {
        showMessage('Server connection error', 'error');
    } finally {
        showLoading(false);
    }
});">
                        💾 Save User
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;" 
                            data-tooltip="Cancel button executes:

document.getElementById('cancelBtn').addEventListener('click', function() {
    userForm.reset();
    document.getElementById('userId').value = '';
    document.getElementById('submitBtn').textContent = '💾 Save User';
    this.style.display = 'none';
});">
                        ❌ Cancel
                    </button>
                </form>
            </div>

            <div class="users-card">
                <h2 data-tooltip="Users list - updates automatically via loadUsers() function">👥 Users List</h2>
                
                <button class="btn" onclick="loadUsers()" 
                        data-tooltip="Refresh button executes loadUsers() function:

async function loadUsers() {
    try {
        showLoading(true);
        
        // Try HTTPS first, then HTTP if needed
        let response = await fetch(API_URL);
        if (!response.ok && API_URL.startsWith('https://')) {
            const httpUrl = API_URL.replace('https://', 'http://');
            response = await fetch(httpUrl);
        }
        
        const result = await response.json();
        
        if (result.success) {
            displayUsers(result.data);
        } else {
            showMessage(result.message, 'error');
            displayUsers(demoUsers);
        }
    } catch (error) {
        console.error('Error loading users:', error);
        showMessage('Server connection error. Showing demo data...', 'error');
        displayUsers(demoUsers);
    } finally {
        showLoading(false);
    }
}">
                    🔄 Refresh List
                </button>
                
                <button class="btn btn-secondary" onclick="testApiConnection()" 
                        data-tooltip="Test API button executes testApiConnection() function:

async function testApiConnection() {
    showMessage('🔍 Testing API connection...', 'success');
    
    const urls = [
        'https://glconnectionbuilder1.com/api.php?action=test_connection',
        'http://glconnectionbuilder1.com/api.php?action=test_connection'
    ];
    
    for (const url of urls) {
        const success = await tryConnection(url);
        if (success) {
            loadUsers();
            return;
        }
    }
    
    showMessage('❌ All connection attempts failed. Check console for details.', 'error');
}

async function tryConnection(url) {
    try {
        console.log(`Trying connection to: ${url}`);
        const response = await fetch(url);
        console.log(`Response status: ${response.status}`);
        
        if (response.ok) {
            const result = await response.json();
            console.log('Response:', result);
            showMessage(`✅ API Connected via ${url}! Status: ${result.message || 'OK'}`, 'success');
            
            window.API_URL = url;
            return true;
        } else {
            console.error(`Failed with status: ${response.status}`);
            showMessage(`❌ ${url} returned HTTP ${response.status}`, 'error');
            return false;
        }
    } catch (error) {
        console.error(`Connection to ${url} failed:`, error);
        showMessage(`❌ ${url} failed: ${error.message}`, 'error');
        return false;
    }
}">
                    🔍 Test API
                </button>
                
                <div class="loading" id="loading">⏳ Loading...</div>
                
                <table class="users-table" id="usersTable" 
                       data-tooltip="HTML table for displaying data - filled dynamically from JSON response">
                    <thead>
                        <tr>
                            <th data-tooltip="ID column - primary key from database">ID</th>
                            <th data-tooltip="Name column - VARCHAR(100) in database">Name</th>
                            <th data-tooltip="Email column - VARCHAR(100) with indexing">Email</th>
                            <th data-tooltip="Phone column - VARCHAR(20) in database">Phone</th>
                            <th data-tooltip="Creation date column - DATETIME with default CURRENT_TIMESTAMP">Created At</th>
                            <th data-tooltip="Actions column - edit and delete buttons for each row">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Data will be added here dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Source Code Buttons -->
    <button class="api-source-btn" onclick="showApiSource()" 
            data-tooltip="View API Code button executes showApiSource() function:

function showApiSource() {
    document.getElementById('apiSourceCode').textContent = API_SOURCE_CODE;
    document.getElementById('apiModal').style.display = 'block';
}">
        📄 View API Code
    </button>
    
    <button class="api-source-btn" onclick="showHtmlSource()" 
            style="bottom: 80px;"
            data-tooltip="View HTML Code button executes showHtmlSource() function:

function showHtmlSource() {
    const htmlSource = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
    document.getElementById('htmlSourceCode').textContent = htmlSource;
    document.getElementById('htmlModal').style.display = 'block';
}">
        🌐 View HTML Code
    </button>

    <!-- API Source Modal -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeApiModal()">&times;</span>
            <h2>🔧 api.php Code - Backend</h2>
            <p><strong>This code runs on Hostinger server and handles MySQL database</strong></p>
            <pre id="apiSourceCode">Loading...</pre>
        </div>
    </div>

    <!-- HTML Source Modal -->
    <div id="htmlModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeHtmlModal()">&times;</span>
            <h2>🌐 index.html Code - Frontend</h2>
            <p><strong>This HTML file contains the complete frontend with CSS and JavaScript</strong></p>
            <pre id="htmlSourceCode">Loading...</pre>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div id="projectDetailsModal" class="project-details-modal">
        <div class="project-details-content">
            <button class="close-details" onclick="closeProjectDetails()">&times;</button>
            
            <div class="project-details-header">
                <h1>🧬 Genetic Invent - Full Stack Demo</h1>
                <p style="font-size: 1.2em; opacity: 0.9;">Comprehensive Educational Platform for Modern Web Technologies</p>
            </div>

            <div class="detail-section">
                <h3>🎯 Project Philosophy & Core Objectives</h3>
                <p>This project has been designed to be an <strong>interactive educational platform</strong> for Genetic Invent employees to understand how modern web applications work from A to Z. The goal is not just to create a user management system, but to create a <strong>comprehensive learning experience</strong> that covers:</p>
                
                <div class="benefits-list">
                    <div class="benefit-item">
                        <strong>🔗 Frontend-Backend Communication:</strong> Understanding how GitHub Pages communicates with Hostinger servers
                    </div>
                    <div class="benefit-item">
                        <strong>💾 CRUD Operations:</strong> Learning Create, Read, Update, Delete in a real environment
                    </div>
                    <div class="benefit-item">
                        <strong>🔒 API Security:</strong> Understanding CORS, validation, and error handling
                    </div>
                    <div class="benefit-item">
                        <strong>🎨 UI/UX Design:</strong> Applying modern design principles and interaction
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>⚡ Technologies Used & Infrastructure</h3>
                <div class="tech-grid">
                    <div class="tech-card">
                        <span class="tech-icon">🌐</span>
                        <h4>Frontend - GitHub Pages</h4>
                        <p>HTML5, CSS3, Vanilla JavaScript<br>
                        <small>Responsive design with advanced animations</small></p>
                    </div>
                    <div class="tech-card">
                        <span class="tech-icon">🔧</span>
                        <h4>Backend - Hostinger PHP</h4>
                        <p>PHP 8+, MySQL Database<br>
                        <small>RESTful API with comprehensive error handling</small></p>
                    </div>
                    <div class="tech-card">
                        <span class="tech-icon">🗄️</span>
                        <h4>Database - MySQL</h4>
                        <p>Structured data storage<br>
                        <small>Auto-increment IDs, timestamps, indexing</small></p>
                    </div>
                    <div class="tech-card">
                        <span class="tech-icon">🔒</span>
                        <h4>Security - CORS & Validation</h4>
                        <p>Cross-origin resource sharing<br>
                        <small>Input validation and prepared statements</small></p>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>🔄 How the System Works - Data Flow</h3>
                <p>Understanding the data flow step by step:</p>
                
                <div class="demo-flow">
                    <div class="flow-step">
                        <strong>1️⃣ User Input</strong><br>
                        <small>Forms & Buttons</small>
                    </div>
                    <div class="flow-step">
                        <strong>2️⃣ JavaScript</strong><br>
                        <small>Event Handling</small>
                    </div>
                    <div class="flow-step">
                        <strong>3️⃣ Fetch API</strong><br>
                        <small>HTTP Requests</small>
                    </div>
                    <div class="flow-step">
                        <strong>4️⃣ PHP Backend</strong><br>
                        <small>Server Processing</small>
                    </div>
                    <div class="flow-step">
                        <strong>5️⃣ MySQL</strong><br>
                        <small>Data Storage</small>
                    </div>
                    <div class="flow-step">
                        <strong>6️⃣ JSON Response</strong><br>
                        <small>Data Return</small>
                    </div>
                    <div class="flow-step">
                        <strong>7️⃣ UI Update</strong><br>
                        <small>Dynamic Display</small>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>🚀 Advanced Educational Features</h3>
                <p>This application is designed to be a <strong>superior educational tool</strong> with special features:</p>
                
                <div class="benefits-list">
                    <div class="benefit-item">
                        <strong>💬 Interactive Tooltips:</strong> Every element contains detailed explanation of its related code
                    </div>
                    <div class="benefit-item">
                        <strong>📋 Source Code Display:</strong> Buttons to view complete PHP and HTML code
                    </div>
                    <div class="benefit-item">
                        <strong>🔍 Connection Testing:</strong> Debugging tools to understand network issues
                    </div>
                    <div class="benefit-item">
                        <strong>📊 Demo Data:</strong> Fallback data when server is unavailable
                    </div>
                    <div class="benefit-item">
                        <strong>⚡ Real-time Feedback:</strong> Instant messages for every operation
                    </div>
                    <div class="benefit-item">
                        <strong>🎨 Animations & Transitions:</strong> Smooth and attractive user experience
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>🎓 Educational Benefits for Employees</h3>
                <div class="benefits-list">
                    <div class="benefit-item">
                        <strong>Backend Development Understanding:</strong> How to create APIs and manage databases
                    </div>
                    <div class="benefit-item">
                        <strong>Advanced Frontend Learning:</strong> JavaScript ES6+, Fetch API, DOM manipulation
                    </div>
                    <div class="benefit-item">
                        <strong>DevOps Concepts:</strong> Deployment on different hosting providers
                    </div>
                    <div class="benefit-item">
                        <strong>Security Best Practices:</strong> Understanding CORS, validation, and SQL injection prevention
                    </div>
                    <div class="benefit-item">
                        <strong>Debugging Skills:</strong> How to diagnose network issues and errors
                    </div>
                    <div class="benefit-item">
                        <strong>Modern Web Standards:</strong> Responsive design, accessibility, performance
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>🛠️ Technical Challenges Solved</h3>
                <p>The project demonstrates solutions to real-world web development problems:</p>
                <ul style="line-height: 2;">
                    <li><strong>CORS Issues:</strong> Solved Cross-Origin problems between GitHub Pages and Hostinger</li>
                    <li><strong>HTTPS/HTTP Fallback:</strong> Automatic switching between protocols</li>
                    <li><strong>Error Handling:</strong> Comprehensive error handling with clear messages</li>
                    <li><strong>Database Auto-Setup:</strong> Automatic table creation on first use</li>
                    <li><strong>Input Validation:</strong> Data validation on both Frontend and Backend</li>
                    <li><strong>Responsive Design:</strong> Works on all devices and screen sizes</li>
                </ul>
            </div>

            <div class="detail-section">
                <h3>🎯 Practical Applications & Uses</h3>
                <p>This project can be used as:</p>
                <div class="benefits-list">
                    <div class="benefit-item">
                        <strong>🏫 Training Material:</strong> Workshops for modern web development
                    </div>
                    <div class="benefit-item">
                        <strong>📚 Technical Reference:</strong> Template for future projects
                    </div>
                    <div class="benefit-item">
                        <strong>🧪 Testing Environment:</strong> Testing ground for new technologies
                    </div>
                    <div class="benefit-item">
                        <strong>💼 Portfolio Piece:</strong> Showcasing technical skills to clients
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>🚀 Future Development Steps</h3>
                <p>Project expansion possibilities:</p>
                <ul style="line-height: 2;">
                    <li><strong>Authentication System:</strong> Adding login/logout and user roles</li>
                    <li><strong>Advanced CRUD:</strong> Search, pagination, sorting, filtering</li>
                    <li><strong>File Upload:</strong> Image and file management</li>
                    <li><strong>Real-time Updates:</strong> WebSocket or Server-Sent Events</li>
                    <li><strong>Mobile App:</strong> React Native or Flutter version</li>
                    <li><strong>API Documentation:</strong> Swagger/OpenAPI integration</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 40px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
                <h3 style="color: #48bb78;">🎉 Enjoy Learning and Exploring!</h3>
                <p>This project was created with love and precision to serve the exceptional Genetic Invent team</p>
                <p style="font-size: 0.9em; opacity: 0.8;">Use the tooltips, check out the code, try all the buttons!</p>
            </div>
        </div>
    </div>

    <!-- Tooltip element -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // API Configuration - try HTTPS first, fallback to HTTP
        const API_URL = 'https://glconnectionbuilder1.com/api.php'; // Hostinger domain with HTTPS
        
        // DOM elements
        const userForm = document.getElementById('userForm');
        const usersTableBody = document.getElementById('usersTableBody');
        const loading = document.getElementById('loading');
        const statusMessage = document.getElementById('statusMessage');
        const tooltip = document.getElementById('tooltip');

        // Tooltip functionality with improved hover behavior
        let tooltipTimer = null;
        let currentTooltipElement = null;

        function showTooltip(element) {
            const tooltipText = element.getAttribute('data-tooltip');
            
            if (tooltipText) {
                currentTooltipElement = element;
                
                // Create tooltip content with close button
                tooltip.innerHTML = `
                    <span class="tooltip-close" onclick="forceHideTooltip()">&times;</span>
                    ${tooltipText}
                `;
                tooltip.classList.add('show');
                
                // Position tooltip
                const rect = element.getBoundingClientRect();
                let left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2);
                let top = rect.top - tooltip.offsetHeight - 10;
                
                // Ensure tooltip stays within screen bounds
                if (left < 10) {
                    left = 10;
                }
                if (left + tooltip.offsetWidth > window.innerWidth - 10) {
                    left = window.innerWidth - tooltip.offsetWidth - 10;
                }
                
                // If tooltip would appear above screen, show it below
                if (top < 10) {
                    top = rect.bottom + 10;
                }
                
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
            }
        }

        function hideTooltip() {
            tooltipTimer = setTimeout(() => {
                tooltip.classList.remove('show');
                currentTooltipElement = null;
            }, 100); // Small delay to allow moving to tooltip
        }

        function cancelHideTooltip() {
            if (tooltipTimer) {
                clearTimeout(tooltipTimer);
                tooltipTimer = null;
            }
        }

        function forceHideTooltip() {
            cancelHideTooltip();
            tooltip.classList.remove('show');
            currentTooltipElement = null;
        }

        // Show tooltip on mouseover
        document.addEventListener('mouseover', function(e) {
            const element = e.target;
            if (element.getAttribute('data-tooltip')) {
                cancelHideTooltip();
                showTooltip(element);
            }
        });

        // Hide tooltip on mouseout (with delay)
        document.addEventListener('mouseout', function(e) {
            const element = e.target;
            if (element.getAttribute('data-tooltip')) {
                hideTooltip();
            }
        });

        // Keep tooltip visible when hovering over it
        tooltip.addEventListener('mouseenter', function() {
            cancelHideTooltip();
        });

        // Hide tooltip when leaving the tooltip itself
        tooltip.addEventListener('mouseleave', function() {
            hideTooltip();
        });

        // Allow text selection in tooltip
        tooltip.addEventListener('mousedown', function(e) {
            e.stopPropagation();
        });

        // Close tooltip with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && tooltip.classList.contains('show')) {
                forceHideTooltip();
            }
            if (e.key === 'Escape' && document.getElementById('projectDetailsModal').style.display === 'block') {
                closeProjectDetails();
            }
        });

        // Project Details Modal Functions
        function showProjectDetails() {
            document.getElementById('projectDetailsModal').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeProjectDetails() {
            document.getElementById('projectDetailsModal').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        // Close modal when clicking outside
        document.getElementById('projectDetailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProjectDetails();
            }
        });

        // Form functionality
        userForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const userId = document.getElementById('userId').value;
            const userName = document.getElementById('userName').value.trim();
            const userEmail = document.getElementById('userEmail').value.trim();
            const userPhone = document.getElementById('userPhone').value.trim();

            // Validate data
            if (!userName || !userEmail || !userPhone) {
                showMessage('All fields are required', 'error');
                return;
            }

            // Determine action (create or update)
            if (userId) {
                formData.append('action', 'update');
                formData.append('id', userId);
            } else {
                formData.append('action', 'create');
            }

            formData.append('name', userName);
            formData.append('email', userEmail);
            formData.append('phone', userPhone);

            try {
                showLoading(true);
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showMessage(result.message, 'success');
                    userForm.reset();
                    document.getElementById('userId').value = '';
                    document.getElementById('submitBtn').textContent = '💾 Save User';
                    document.getElementById('cancelBtn').style.display = 'none';
                    loadUsers();
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('Connection error:', error);
                showMessage('Server connection error. Please check API URL.', 'error');
            } finally {
                showLoading(false);
            }
        });

        // Load users
        async function loadUsers() {
            try {
                showLoading(true);
                console.log('Attempting to connect to API:', API_URL + '?action=read');
                
                const response = await fetch(API_URL + '?action=read');
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('API Response:', result);

                if (result.success) {
                    displayUsers(result.users || result.data?.users || []);
                    showMessage('Data loaded successfully from server', 'success');
                } else {
                    showMessage('Error loading data: ' + result.message, 'error');
                    console.error('API returned error:', result);
                }
            } catch (error) {
                console.error('Detailed error loading users:', error);
                console.error('Error type:', error.name);
                console.error('Error message:', error.message);
                
                // Test if API is reachable at all
                testApiConnection();
                
                showMessage(`Connection failed: ${error.message}. Showing demo data...`, 'error');
                
                // Show demo data when no connection
                displayUsers([
                    {
                        id: 1,
                        name: 'John Doe',
                        email: 'john@example.com',
                        phone: '1234567890',
                        created_at: '2024-01-15 10:30:00'
                    },
                    {
                        id: 2,
                        name: 'Jane Smith',
                        email: 'jane@example.com',
                        phone: '0987654321',
                        created_at: '2024-01-16 14:20:00'
                    }
                ]);
            } finally {
                showLoading(false);
            }
        }

        // Test API connection with fallback
        async function testApiConnection() {
            showLoading(true);
            console.log('Testing API connection...');
            showMessage('Testing API connection...', 'success');
            
            // Try HTTPS first
            let success = await tryConnection('https://glconnectionbuilder1.com/api.php');
            
            // If HTTPS fails, try HTTP
            if (!success) {
                console.log('HTTPS failed, trying HTTP...');
                showMessage('HTTPS failed, trying HTTP...', 'success');
                success = await tryConnection('http://glconnectionbuilder1.com/api.php');
            }
            
            showLoading(false);
        }
        
        async function tryConnection(url) {
            try {
                console.log(`Trying connection to: ${url}`);
                const response = await fetch(url);
                console.log(`Response status: ${response.status}`);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Response:', result);
                    showMessage(`✅ API Connected via ${url}! Status: ${result.message || 'OK'}`, 'success');
                    
                    // Update the global API_URL if this works
                    window.API_URL = url;
                    return true;
                } else {
                    console.error(`Failed with status: ${response.status}`);
                    showMessage(`❌ ${url} returned HTTP ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                console.error(`Connection to ${url} failed:`, error);
                showMessage(`❌ ${url} failed: ${error.message}`, 'error');
                return false;
            }
        }

        // Display users in table
        function displayUsers(users) {
            usersTableBody.innerHTML = '';

            if (!users || users.length === 0) {
                usersTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #666;">
                            No data to display
                        </td>
                    </tr>
                `;
                return;
            }

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-tooltip="User ID in database">${user.id}</td>
                    <td data-tooltip="Stored user name">${user.name}</td>
                    <td data-tooltip="Unique email address">${user.email}</td>
                    <td data-tooltip="Phone number">${user.phone}</td>
                    <td data-tooltip="User creation date">${user.created_at}</td>
                    <td class="action-buttons">
                        <button class="btn" onclick="editUser(${user.id}, '${user.name}', '${user.email}', '${user.phone}')" 
                                data-tooltip="Edit button executes editUser() function:

function editUser(id, name, email, phone) {
    document.getElementById('userId').value = id;
    document.getElementById('userName').value = name;
    document.getElementById('userEmail').value = email;
    document.getElementById('userPhone').value = phone;
    document.getElementById('submitBtn').textContent = '💾 Update User';
    document.getElementById('cancelBtn').style.display = 'inline-block';
    
    // Scroll to form
    document.getElementById('userForm').scrollIntoView({ behavior: 'smooth' });
}">
                            ✏️ Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteUser(${user.id}, '${user.name}')" 
                                data-tooltip="Delete button executes deleteUser() function:

async function deleteUser(id, name) {
    if (!confirm('Are you sure you want to delete user ' + name + '?')) {
        return;
    }

    try {
        showLoading(true);
        const formData = new FormData();
        formData.append('action', 'delete');
        formData.append('id', id);

        const response = await fetch(API_URL, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            showMessage(result.message, 'success');
            loadUsers();
        } else {
            showMessage(result.message, 'error');
        }
    } catch (error) {
        console.error('Error deleting user:', error);
        showMessage('Server connection error', 'error');
    } finally {
        showLoading(false);
    }
}">
                            🗑️ Delete
                        </button>
                    </td>
                `;
                usersTableBody.appendChild(row);
            });
        }

        // Edit user
        function editUser(id, name, email, phone) {
            document.getElementById('userId').value = id;
            document.getElementById('userName').value = name;
            document.getElementById('userEmail').value = email;
            document.getElementById('userPhone').value = phone;
            document.getElementById('submitBtn').textContent = '💾 Update User';
            document.getElementById('cancelBtn').style.display = 'inline-block';
            
            // Scroll to form
            document.getElementById('userForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Cancel edit
        document.getElementById('cancelBtn').addEventListener('click', function() {
            userForm.reset();
            document.getElementById('userId').value = '';
            document.getElementById('submitBtn').textContent = '💾 Save User';
            this.style.display = 'none';
        });

        // Delete user
        async function deleteUser(id, name) {
            if (!confirm(`Are you sure you want to delete user "${name}"?`)) {
                return;
            }

            try {
                showLoading(true);
                const formData = new FormData();
                formData.append('action', 'delete');
                formData.append('id', id);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showMessage(result.message, 'success');
                    loadUsers();
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showMessage('Server connection error', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Show status message
        function showMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';

            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Show loading
        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        // Show API source - fetch complete code from server
        async function showApiSource() {
            try {
                showLoading(true);
                document.getElementById('apiSourceCode').textContent = 'Loading API source code...';
                document.getElementById('apiModal').style.display = 'block';
                
                // Try to fetch the actual api.php file content
                let apiContent = '';
                try {
                    const response = await fetch('api.php?action=get_api_source');
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.source) {
                            apiContent = result.source;
                        } else {
                            throw new Error('Source not available from server');
                        }
                    } else {
                        throw new Error('Cannot fetch from server');
                    }
                } catch (fetchError) {
                    console.log('Fallback to embedded source code');
                    // Fallback to the complete embedded source
                    apiContent = getCompleteApiSource();
                }
                
                document.getElementById('apiSourceCode').textContent = apiContent;
            } catch (error) {
                console.error('Error showing API source:', error);
                document.getElementById('apiSourceCode').textContent = 'Error loading API source code. Please check console for details.';
            } finally {
                showLoading(false);
            }
        }

        // Complete API source code (fallback)
        function getCompleteApiSource() {
            return `<?php
/**
 * User Management System - API Backend
 * Demo project for Genetic Invent Company
 * 
 * This file provides API for handling CRUD operations on users
 * Runs on Hostinger server with MySQL database
 */

// Database configuration - Hostinger
const DB_HOST = 'localhost';
const DB_NAME = 'u419999707_Demo';
const DB_USER = 'u419999707_NaifDemo';
const DB_PASS = 'P@master5007';
const DB_PORT = 3306;

// Enable error reporting for development (should be disabled in production)
error_reporting(E_ALL);
ini_set('display_errors', 1);

// CORS settings to allow requests from any origin (for demo purposes)
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With, Origin');
header('Access-Control-Allow-Credentials: false');
header('Content-Type: application/json; charset=utf-8');

// Additional headers for better compatibility
header('Vary: Origin');
header('Cache-Control: no-cache, must-revalidate');

// Handle OPTIONS requests (preflight requests)
if ($_SERVER['REQUEST_METHOD'] == 'OPTIONS') {
    http_response_code(200);
    exit();
}

/**
 * Function to log errors and operations
 */
function logMessage($message, $type = 'INFO') {
    $timestamp = date('Y-m-d H:i:s');
    $logEntry = "[$timestamp] [$type] $message" . PHP_EOL;
    
    // Can save logs to file if needed
    // file_put_contents('api_log.txt', $logEntry, FILE_APPEND);
    
    // For development: display in console
    if ($type == 'ERROR') {
        error_log($logEntry);
    }
}

/**
 * Function to validate email
 */
function validateEmail($email) {
    return filter_var($email, FILTER_VALIDATE_EMAIL) !== false;
}

/**
 * Function to validate phone number
 */
function validatePhone($phone) {
    // Simple pattern for phone number validation
    return preg_match('/^[0-9+\\-\\s()]{10,20}$/', $phone);
}

/**
 * Function to send JSON response
 */
function sendResponse($success, $message, $data = null, $httpCode = 200) {
    http_response_code($httpCode);
    
    $response = [
        'success' => $success,
        'message' => $message,
        'timestamp' => date('Y-m-d H:i:s')
    ];
    
    if ($data !== null) {
        $response['data'] = $data;
    }
    
    echo json_encode($response, JSON_UNESCAPED_UNICODE);
    exit();
}

try {
    // Log request start
    logMessage("API Request: " . $_SERVER['REQUEST_METHOD'] . " " . $_SERVER['REQUEST_URI']);
    
    // Database connection with better error handling
    $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";port=" . DB_PORT . ";charset=utf8mb4";
    $options = [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false,
        PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci"
    ];
    
    $pdo = new PDO($dsn, DB_USER, DB_PASS, $options);
    logMessage("Database connection established successfully");
    
    // Test the connection
    $pdo->query("SELECT 1");
    logMessage("Database test query successful");

    // Create users table if it doesn't exist
    $createTableQuery = "
        CREATE TABLE IF NOT EXISTS users (
            id INT AUTO_INCREMENT PRIMARY KEY,
            name VARCHAR(100) NOT NULL,
            email VARCHAR(100) NOT NULL UNIQUE,
            phone VARCHAR(20) NOT NULL,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            INDEX idx_email (email),
            INDEX idx_created_at (created_at)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
    ";
    
    $pdo->exec($createTableQuery);
    logMessage("Users table checked/created successfully");

    // Determine required action
    $action = $_POST['action'] ?? $_GET['action'] ?? '';
    logMessage("Action requested: " . $action);

    switch ($action) {
        case 'create':
            // === Create new user ===
            logMessage("Processing CREATE user request");
            
            $name = trim($_POST['name'] ?? '');
            $email = trim($_POST['email'] ?? '');
            $phone = trim($_POST['phone'] ?? '');

            // Validate required data
            if (empty($name)) {
                sendResponse(false, 'Username is required', null, 400);
            }
            
            if (empty($email)) {
                sendResponse(false, 'Email is required', null, 400);
            }
            
            if (empty($phone)) {
                sendResponse(false, 'Phone number is required', null, 400);
            }

            // Validate data format
            if (!validateEmail($email)) {
                sendResponse(false, 'Invalid email format', null, 400);
            }

            if (!validatePhone($phone)) {
                sendResponse(false, 'Invalid phone number format', null, 400);
            }

            // Validate data length
            if (strlen($name) > 100) {
                sendResponse(false, 'Name too long (maximum 100 characters)', null, 400);
            }

            if (strlen($email) > 100) {
                sendResponse(false, 'Email too long (maximum 100 characters)', null, 400);
            }

            // Check for duplicate email
            $checkStmt = $pdo->prepare("SELECT id FROM users WHERE email = ?");
            $checkStmt->execute([$email]);
            if ($checkStmt->fetch()) {
                sendResponse(false, 'Email already exists', null, 409);
            }

            // Insert new user
            $stmt = $pdo->prepare("INSERT INTO users (name, email, phone) VALUES (?, ?, ?)");
            $stmt->execute([$name, $email, $phone]);
            
            $userId = $pdo->lastInsertId();
            logMessage("User created successfully with ID: " . $userId);

            sendResponse(true, 'User created successfully', [
                'user_id' => $userId,
                'name' => $name,
                'email' => $email
            ]);
            break;

        case 'read':
            // === Read all users ===
            logMessage("Processing READ users request");
            
            // Add search and pagination capability
            $search = $_GET['search'] ?? '';
            $page = max(1, (int)($_GET['page'] ?? 1));
            $limit = min(100, max(1, (int)($_GET['limit'] ?? 50))); // Maximum 100
            $offset = ($page - 1) * $limit;

            // Build query with search
            $whereClause = '';
            $params = [];
            
            if (!empty($search)) {
                $whereClause = 'WHERE name LIKE ? OR email LIKE ? OR phone LIKE ?';
                $searchParam = '%' . $search . '%';
                $params = [$searchParam, $searchParam, $searchParam];
            }

            // Get total count
            $countQuery = "SELECT COUNT(*) as total FROM users $whereClause";
            $countStmt = $pdo->prepare($countQuery);
            $countStmt->execute($params);
            $totalCount = $countStmt->fetch()['total'];

            // Get users with pagination
            $query = "SELECT * FROM users $whereClause ORDER BY created_at DESC LIMIT $limit OFFSET $offset";
            $stmt = $pdo->prepare($query);
            $stmt->execute($params);
            $users = $stmt->fetchAll();

            logMessage("Retrieved " . count($users) . " users (page $page, total: $totalCount)");

            sendResponse(true, 'Users retrieved successfully', [
                'users' => $users,
                'pagination' => [
                    'page' => $page,
                    'limit' => $limit,
                    'total' => $totalCount,
                    'pages' => ceil($totalCount / $limit)
                ]
            ]);
            break;

        case 'update':
            // === Update user ===
            logMessage("Processing UPDATE user request");
            
            $id = $_POST['id'] ?? '';
            $name = trim($_POST['name'] ?? '');
            $email = trim($_POST['email'] ?? '');
            $phone = trim($_POST['phone'] ?? '');

            // Validate required data
            if (empty($id)) {
                sendResponse(false, 'User ID is required', null, 400);
            }
            
            if (empty($name)) {
                sendResponse(false, 'Username is required', null, 400);
            }
            
            if (empty($email)) {
                sendResponse(false, 'Email is required', null, 400);
            }
            
            if (empty($phone)) {
                sendResponse(false, 'Phone number is required', null, 400);
            }

            // Validate data format
            if (!validateEmail($email)) {
                sendResponse(false, 'Invalid email format', null, 400);
            }

            if (!validatePhone($phone)) {
                sendResponse(false, 'Invalid phone number format', null, 400);
            }

            // Check if user exists
            $checkStmt = $pdo->prepare("SELECT id FROM users WHERE id = ?");
            $checkStmt->execute([$id]);
            if (!$checkStmt->fetch()) {
                sendResponse(false, 'User not found', null, 404);
            }

            // Check for duplicate email (excluding current user)
            $duplicateStmt = $pdo->prepare("SELECT id FROM users WHERE email = ? AND id != ?");
            $duplicateStmt->execute([$email, $id]);
            if ($duplicateStmt->fetch()) {
                sendResponse(false, 'Email already exists for another user', null, 409);
            }

            // Update user
            $stmt = $pdo->prepare("UPDATE users SET name=?, email=?, phone=? WHERE id=?");
            $stmt->execute([$name, $email, $phone, $id]);

            logMessage("User updated successfully: ID $id");

            sendResponse(true, 'User updated successfully', [
                'user_id' => $id,
                'name' => $name,
                'email' => $email
            ]);
            break;

        case 'delete':
            // === Delete user ===
            logMessage("Processing DELETE user request");
            
            $id = $_POST['id'] ?? $_GET['id'] ?? '';
            
            if (empty($id)) {
                sendResponse(false, 'User ID is required', null, 400);
            }

            // Check if user exists
            $checkStmt = $pdo->prepare("SELECT name FROM users WHERE id = ?");
            $checkStmt->execute([$id]);
            $user = $checkStmt->fetch();
            
            if (!$user) {
                sendResponse(false, 'User not found', null, 404);
            }

            // Delete user
            $stmt = $pdo->prepare("DELETE FROM users WHERE id = ?");
            $stmt->execute([$id]);

            logMessage("User deleted successfully: " . $user['name'] . " (ID: $id)");

            sendResponse(true, 'User deleted successfully', [
                'deleted_user' => $user['name']
            ]);
            break;

        case 'get_single':
            // === Get single user ===
            logMessage("Processing GET SINGLE user request");
            
            $id = $_GET['id'] ?? '';
            
            if (empty($id)) {
                sendResponse(false, 'User ID is required', null, 400);
            }

            $stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
            $stmt->execute([$id]);
            $user = $stmt->fetch();

            if (!$user) {
                sendResponse(false, 'User not found', null, 404);
            }

            logMessage("Single user retrieved: " . $user['name']);

            sendResponse(true, 'User retrieved successfully', [
                'user' => $user
            ]);
            break;

        case 'stats':
            // === Get database statistics ===
            logMessage("Processing STATS request");
            
            $stmt = $pdo->query("SELECT COUNT(*) as total_users FROM users");
            $totalUsers = $stmt->fetch()['total_users'];

            $stmt = $pdo->query("SELECT COUNT(*) as users_today FROM users WHERE DATE(created_at) = CURDATE()");
            $usersToday = $stmt->fetch()['users_today'];

            $stmt = $pdo->query("SELECT COUNT(*) as users_this_week FROM users WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)");
            $usersThisWeek = $stmt->fetch()['users_this_week'];

            sendResponse(true, 'Statistics retrieved successfully', [
                'total_users' => $totalUsers,
                'users_today' => $usersToday,
                'users_this_week' => $usersThisWeek,
                'server_time' => date('Y-m-d H:i:s')
            ]);
            break;

        case 'get_api_source':
            // === Return API source code ===
            logMessage("Processing GET API SOURCE request");
            
            try {
                $sourceCode = file_get_contents(__FILE__);
                sendResponse(true, 'API source code retrieved', [
                    'source' => $sourceCode,
                    'file_size' => strlen($sourceCode),
                    'lines' => substr_count($sourceCode, "\\n") + 1
                ]);
            } catch (Exception $e) {
                sendResponse(false, 'Cannot read source file: ' . $e->getMessage(), null, 500);
            }
            break;

        case 'test_connection':
            // === Test database connection ===
            logMessage("Processing TEST CONNECTION request");
            
            try {
                $stmt = $pdo->query("SELECT COUNT(*) as user_count FROM users");
                $userCount = $stmt->fetch()['user_count'];
                
                sendResponse(true, 'Database connection successful', [
                    'database' => DB_NAME,
                    'user_count' => $userCount,
                    'server_time' => date('Y-m-d H:i:s'),
                    'php_version' => PHP_VERSION
                ]);
            } catch (Exception $e) {
                sendResponse(false, 'Database connection test failed: ' . $e->getMessage(), null, 500);
            }
            break;

        case '':
        default:
            // === Default response - API documentation ===
            logMessage("API Documentation request or unknown action: '$action'");
            
            $endpoints = [
                'create' => 'POST - Create new user (requires: name, email, phone)',
                'read' => 'GET - Get all users (optional: search, page, limit)',
                'update' => 'POST - Update user (requires: id, name, email, phone)',
                'delete' => 'POST/GET - Delete user (requires: id)',
                'get_single' => 'GET - Get single user (requires: id)',
                'stats' => 'GET - Get database statistics',
                'get_api_source' => 'GET - Get API source code',
                'test_connection' => 'GET - Test database connection'
            ];

            sendResponse(true, 'Genetic Invent User Management API', [
                'version' => '2.0',
                'database' => DB_NAME,
                'endpoints' => $endpoints,
                'usage' => 'Add ?action=endpoint_name to URL or include action in POST data',
                'documentation' => 'Each endpoint returns JSON with success, message, and data fields'
            ]);
            break;
    }

} catch (PDOException $e) {
    logMessage("Database error: " . $e->getMessage(), 'ERROR');
    sendResponse(false, 'Database connection failed: ' . $e->getMessage(), null, 500);
} catch (Exception $e) {
    logMessage("General error: " . $e->getMessage(), 'ERROR');
    sendResponse(false, 'Server error: ' . $e->getMessage(), null, 500);
}
?>`;
        }

        // Close API modal
        function closeApiModal() {
            document.getElementById('apiModal').style.display = 'none';
        }

        // Show HTML source
        function showHtmlSource() {
            try {
                showLoading(true);
                document.getElementById('htmlSourceCode').textContent = 'Loading HTML source code...';
                document.getElementById('htmlModal').style.display = 'block';
                
                // Get the complete HTML source including DOCTYPE
                const htmlSource = getCompleteHtmlSource();
                document.getElementById('htmlSourceCode').textContent = htmlSource;
            } catch (error) {
                console.error('Error showing HTML source:', error);
                document.getElementById('htmlSourceCode').textContent = 'Error loading HTML source code. Please check console for details.';
            } finally {
                showLoading(false);
            }
        }

        // Get complete HTML source
        function getCompleteHtmlSource() {
            // Get the actual HTML including DOCTYPE and all content
            const doctype = '<!DOCTYPE html>';
            const htmlElement = document.documentElement.outerHTML;
            
            // Format the HTML nicely with proper indentation
            const formattedHtml = formatHtml(doctype + '\\n' + htmlElement);
            
            return formattedHtml;
        }

        // Simple HTML formatter for better readability
        function formatHtml(html) {
            let formatted = '';
            let indent = 0;
            const lines = html.split('\\n');
            
            for (let line of lines) {
                line = line.trim();
                if (line.length === 0) continue;
                
                // Decrease indent for closing tags
                if (line.startsWith('</')) {
                    indent = Math.max(0, indent - 2);
                }
                
                // Add indentation
                formatted += ' '.repeat(indent) + line + '\\n';
                
                // Increase indent for opening tags (but not self-closing or already closed)
                if (line.startsWith('<') && !line.startsWith('</') && !line.endsWith('/>') && !line.includes('</')) {
                    // Check if it's not a self-closing tag
                    const tagName = line.match(/<(\\w+)/);
                    if (tagName) {
                        const selfClosingTags = ['img', 'input', 'br', 'hr', 'meta', 'link', 'area', 'base', 'col', 'embed', 'source', 'track', 'wbr'];
                        if (!selfClosingTags.includes(tagName[1].toLowerCase())) {
                            indent += 2;
                        }
                    }
                }
            }
            
            return formatted;
        }

        // Close HTML modal
        function closeHtmlModal() {
            document.getElementById('htmlModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const apiModal = document.getElementById('apiModal');
            const htmlModal = document.getElementById('htmlModal');
            const projectModal = document.getElementById('projectDetailsModal');
            
            if (event.target == apiModal) {
                apiModal.style.display = 'none';
            }
            if (event.target == htmlModal) {
                htmlModal.style.display = 'none';
            }
            if (event.target == projectModal) {
                closeProjectDetails();
            }
        }

        // Load data on startup
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
            
            // Developer message
            console.log(`
🧬 Genetic Invent Project - User Management System

📋 System Information:
1. API URL: http://glconnectionbuilder1.com/api.php
2. Database: u419999707_Demo (NaifDemo user)
3. Backend should be configured on Hostinger

🔧 Debugging Steps:
1. Click "Test API" button in the interface
2. Check browser console for detailed error messages
3. Try these URLs directly in browser:
   - http://glconnectionbuilder1.com/api.php
   - http://glconnectionbuilder1.com/api.php?action=test_connection
4. Look for CORS, network, or server errors

🎯 Educational Purpose:
- Hover over any element to see explanatory tooltip
- Click "View API Code" button to see source code

🐛 If you see "Server connection error":
- The API server might be down
- Database connection might be failing
- CORS headers might be missing
- Check the Network tab in Developer Tools
            `);
        });
    </script>
</body>
</html> 